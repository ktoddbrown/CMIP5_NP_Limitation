    ##create the common 1x1 templet
    newproj <- '+proj=longlat'
    templetCommon <- raster(nrows=180, ncols=360, xmn=-180, xmx=180, ymn=-90, ymx=90, crs=newproj)

    cat('loading biomask...')
    biomeMask <- raster('nutrientMaps/MOD12Q1_fill_1dgr.nc') #12 is Agg
    biomeMask <- projectRaster(biomeMask, templetCommon)
    biomeMask <- rasterToArray(biomeMask)
    cat('done\n')

    cat('constructing CtoN|P...')
CtoNsoil.arr <- c(16.1, 12.8, 24.8, 30, 10.1, 19.3, 15.0, 15.0, 13.1, 13.2, 26.8)

    CtoNutrient.mtx <- matrix(
        c(Inf,   Inf,
          0.1021217E+03,    0.1328857E+04,
          0.4674353E+02,    0.1136019E+04,
          0.1031860E+03,    0.1063311E+04,
          0.5831366E+02,    0.8882278E+03,
          0.9045517E+02,    0.1051518E+04,
          0.5830027E+02,    0.7149689E+03,
          0.5830027E+02,    0.7149689E+03,
          0.4603385E+02,    0.8965328E+03,
          0.4796446E+02,    0.8703600E+03,
          0.6093211E+02,    0.9928398E+03,
          Inf,    Inf, #ag
          0.6093211E+02,    0.9928398E+03) ,
                              nrow=13, ncol=2, byrow=TRUE)
    CtoN <- biomeMask
    CtoP <- biomeMask
    CtoNsoil <- biomeMask
    for(ii in 1:13){
        CtoN[biomeMask==ii] <- CtoNutrient.mtx[ii,1]
        CtoP[biomeMask==ii] <- CtoNutrient.mtx[ii,2]
        CtoNsoil[biomeMask == ii] <- CtoNsoil.arr[ii]
    }
    cat('done\n')

    ##NnewNPP, PnewNPP
    cat('loading N|P new NPP, N|P input rates, land area, and associated year. (Ignore the errors generated here)...\n')
    ##sadly raster doesn't play nicely with the file for some reason
    data.nc <- open.ncdf('nutrientMaps/ann_Input_data.nc')

    NnewNPP <- get.var.ncdf(data.nc, varid='input_npp_N')
    NnewNPP[NnewNPP > 1e20] <- NA
    NnewNPP[array(biomeMask, dim=dim(NnewNPP)) == 12] <- Inf

    PnewNPP <- get.var.ncdf(data.nc, varid='input_npp_P')
    PnewNPP[PnewNPP > 1e20] <- NA
    PnewNPP[array(biomeMask, dim=dim(PnewNPP)) == 12] <- Inf


    NInRate <- NnewNPP/array(CtoN, dim=dim(NnewNPP))

    PInRate <- PnewNPP/array(CtoP, dim=dim(PnewNPP))

    NInRate[array(biomeMask, dim=dim(NInRate)) == 12] <- Inf
    PInRate[array(biomeMask, dim=dim(PInRate)) == 12] <- Inf


landarea <- get.var.ncdf(data.nc, varid='landarea')
yr <- get.var.ncdf(data.nc, varid='year')
close(data.nc)
cat('done\n')

yrStr.InRate <- as.character(yr)
NIn_tot <- apply(NInRate, c(3), function(x){sum(as.vector(x*landarea)[is.finite(x)], na.rm=TRUE)})/1e12
PIn_tot <- apply(PInRate, c(3), function(x){sum(as.vector(x*landarea)[is.finite(x)], na.rm=TRUE)})/1e12

newNNPP_tot <- apply(NnewNPP, c(3), function(x){sum(as.vector(x*landarea)[is.finite(x)], na.rm=TRUE)})/1e12
newPNPP_tot <- apply(PnewNPP, c(3), function(x){sum(as.vector(x*landarea)[is.finite(x)], na.rm=TRUE)})/1e12
